# 溃坝过程预测系统使用文档

## 系统概述

溃坝过程预测系统是一个集成了多种预测模型的Web应用程序，用于预测溃坝过程中的关键参数，如峰值流量和溃决历时。系统集成了两类模型：

1. **MATLAB机器学习模型**：基于机器学习方法的快速预测模型，包括峰值流量预测和溃决历时预测。
2. **Python数值模拟模型**：基于物理方程的详细溃坝过程模拟，包括VANRIJN、BREACH等多种模型。

## 系统架构

系统采用前后端分离的架构，由以下主要部分组成：

### 前端架构

前端采用纯HTML、CSS和JavaScript实现，不依赖任何前端框架，目录结构如下：

```
frontend/
├── css/            # CSS样式文件
│   ├── common.css  # 通用样式
│   ├── index.css   # 首页样式
│   └── ...
├── js/             # JavaScript脚本
│   ├── earth.js    # 3D地球相关代码
│   ├── index.js    # 首页交互逻辑
│   └── ...
├── images/         # 图片资源
├── components/     # 可复用组件
└── index.html      # 主页面
```

主要功能模块：

- **3D地球可视化**：使用Three.js实现的交互式地球，显示大坝地理位置。
- **数据可视化**：使用Chart.js实现的数据图表，展示监测数据和预测结果。
- **模型预测界面**：提供模型选择和参数输入功能，与后端API交互获取预测结果。

### 后端架构

后端采用Python Flask框架实现，采用模块化设计，目录结构如下：

```
backend/
├── api/            # API接口模块
│   ├── __init__.py
│   └── api_routes.py  # API路由定义
├── models/         # 模型模块
│   └── __init__.py
├── utils/          # 工具模块
│   ├── __init__.py
│   ├── data_utils.py   # 数据处理工具
│   ├── matlab_utils.py # MATLAB调用工具
│   └── model_utils.py  # 模型调用工具
├── config/         # 配置模块
│   └── __init__.py
└── app.py          # 应用入口
```

主要功能模块：

- **API接口**：提供RESTful API，处理前端请求，返回JSON格式数据。
- **模型调用**：封装Python模型和MATLAB模型的调用接口，统一返回格式。
- **数据处理**：提供数据读取、处理和转换功能，支持多种数据源。

### MATLAB服务

MATLAB服务位于`修改后副本`目录，包含以下主要文件：

```
修改后副本/
├── Main_program_Q.m      # 峰值流量预测主程序
├── Main_program_T.m      # 溃决历时预测主程序
├── classify_D.m          # 峰值流量数据归类脚本
├── classify_T.m          # 溃决历时数据归类脚本
├── 同质峰值流量/         # 同质峰值流量预测模型
├── 同质溃决历时/         # 同质溃决历时预测模型
├── 异质峰值流量/         # 异质峰值流量预测模型
└── 异质溃决历时/         # 异质溃决历时预测模型
```

### 系统集成

系统通过以下方式实现集成：

1. **前后端通信**：前端通过RESTful API与后端通信，使用JSON格式交换数据。
2. **Python调用MATLAB**：后端通过subprocess模块调用MATLAB命令行，实现Python与MATLAB的集成。
3. **统一接口**：为不同类型的模型提供统一的调用接口和返回格式，简化前端处理逻辑。

## 安装与配置

### 依赖项

系统依赖以下软件和库：

- Python 3.6+
- Flask
- Flask-CORS
- Pandas
- NumPy
- Matplotlib
- MATLAB R2019b+（用于机器学习模型）

### 安装步骤

1. 安装Python依赖：
   ```bash
   pip install flask flask-cors pandas numpy matplotlib openpyxl
   ```

2. 确保MATLAB已安装并配置好环境变量。

3. 将MATLAB模型文件放置在`修改后副本`目录中。

## 使用方法

### 启动系统

1. 进入系统目录：
   ```bash
   cd /path/to/python_map/pythonApp
   ```

2. 启动Web服务器：
   ```bash
   python web_server.py
   ```

3. 在浏览器中访问：
   ```
   http://localhost:5080
   ```

### 使用界面

系统提供了两个主要页面：

1. **大坝监测页面**：显示大坝的地理位置、监测数据和风险统计。
2. **模型预测页面**：提供模型选择和参数输入功能，用于预测溃坝过程。

#### 模型预测步骤

1. 在底部导航栏中点击"模型预测"进入预测页面。
2. 在左侧面板中选择预测模型：
   - **峰值流量预测**：预测溃坝过程中的最大流量。
   - **溃决历时预测**：预测溃坝过程的持续时间。
   - **Van Rijn模型**：详细的溃坝过程模拟。
   - **BREACH模型**：经典的溃坝模拟模型。
3. 输入参数：
   - **坝高**：大坝高度（米）。
   - **坝宽**：大坝宽度（米）。
   - **库容**：水库容量（立方米）。
   - **物质组成**：大坝材料类型（土质为主、土含块石、块石夹土、块石为主）。
4. 点击"开始计算"按钮进行计算。
5. 计算结果将显示在右侧面板中，包括预测值和结果图表。

## 模型说明

### MATLAB机器学习模型

1. **峰值流量预测**：使用Stacking集成学习方法，结合LightGBM、随机森林和XGBoost基学习器，预测溃坝过程中的峰值流量。
2. **溃决历时预测**：使用Stacking集成学习方法，预测溃坝过程的持续时间。

### Python数值模拟模型

1. **Van Rijn模型**：基于Van Rijn公式的溃坝过程模拟，考虑了水流冲刷和泥沙运动。
2. **BREACH模型**：经典的溃坝模拟模型，考虑了多种物理因素。
3. **其他模型**：CHEN、DAMBRK、MPM、SMART、WANG、YANG等多种模型，适用于不同的溃坝情景。

## 故障排除

### 常见问题

1. **服务器启动失败**：
   - 检查是否安装了所有依赖项。
   - 检查端口5080是否被占用。

2. **模型计算错误**：
   - 检查输入参数是否合理。
   - 检查MATLAB是否正确安装和配置。

3. **界面显示异常**：
   - 清除浏览器缓存后重试。
   - 检查浏览器控制台是否有错误信息。

### 联系支持

如有问题，请联系系统管理员或开发团队。

## 开发者信息

本系统由溃坝过程预测团队开发，版权所有。

最后更新：2025年10月4日